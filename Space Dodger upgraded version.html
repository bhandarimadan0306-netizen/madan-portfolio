<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Space Dodger — Shooter Edition</title>
<style>
  :root{--bg:#07101a;--ship:#7fe3ff;--enemy:#ff7b7b;--text:#e6f7ff;--coin:#ffd700}
  html,body{height:100%;margin:0;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial}
  body{display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#021018,#082229);color:var(--text)}
  .wrap{width:min(920px,96vw);max-width:1000px;padding:18px}
  h1{margin:0 0 12px;font-size:20px}
  .top{display:flex;gap:12px;align-items:center;margin-bottom:8px}
  #game{background:var(--bg);display:block;border-radius:10px;box-shadow:0 8px 30px rgba(2,20,30,.6);width:100%;height:540px}
  .controls{display:flex;gap:8px;align-items:center}
  button{background:#0b2b35;border:1px solid rgba(255,255,255,.06);color:var(--text);padding:8px 12px;border-radius:8px;cursor:pointer}
  button:active{transform:translateY(1px)}
  .info{margin-left:auto;text-align:right}
  .small{font-size:13px;color:rgba(230,247,255,.8)}
  .hint{font-size:13px;color:rgba(230,247,255,.7);margin-top:8px}
  @media (max-width:600px){#game{height:440px}}
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div>
      <h1>Space Dodger — Shooter Edition</h1>
      <div class="small">Move freely. Collect coins. Shoot asteroids automatically!</div>
    </div>
    <div class="controls">
      <button id="startBtn">Start</button>
      <button id="pauseBtn">Pause</button>
      <button id="resetBtn">Reset</button>
      <div class="info">
        <div>Score: <span id="score">0</span></div>
        <div class="small">Highscore: <span id="high">0</span></div>
        <div>Coins: <span id="coins">0</span></div>
      </div>
    </div>
  </div>
  <canvas id="game" width="900" height="540"></canvas>
</div>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const resetBtn = document.getElementById('resetBtn');
  const scoreEl = document.getElementById('score');
  const highEl = document.getElementById('high');
  const coinsEl = document.getElementById('coins');

  let W = canvas.width;
  let H = canvas.height;

  const stars = Array.from({length: 150}, () => ({
    x: Math.random()*W,
    y: Math.random()*H,
    size: Math.random()*2+1,
    speed: Math.random()*0.5+0.1
  }));

  function resize() {
    const ratio = canvas.width / canvas.height;
    const w = Math.min(window.innerWidth * 0.96, 920);
    const h = Math.round(w / ratio);
    canvas.style.width = w + 'px';
    canvas.style.height = h + 'px';
  }
  window.addEventListener('resize', resize);
  resize();

  const state = {
    running:false,
    paused:false,
    gameover:false,
    win:false,
    score:0,
    coins:0,
    high: Number(localStorage.getItem('space_dodger_high') || 0),
    lastTime:0,
    spawnTimer:0,
    spawnInterval:1400,
    speedMultiplier:1,
    bulletTimer:0,
    bulletInterval:300
  };
  highEl.textContent = state.high;

  const player = { x: W/2, y: H - 80, w: 46, h: 56, speed: 6, vx: 0, vy:0 };

  const keys = {};
  window.addEventListener('keydown', e => {
    keys[e.key.toLowerCase()] = true;
    if (e.key === 'r' || e.key === 'R') resetGame();
    if (e.key === ' ' || e.key === 'Spacebar') togglePause();
  });
  window.addEventListener('keyup', e => { keys[e.key.toLowerCase()] = false; });

  const enemies = [];
  const coinsArr = [];
  const bullets = [];
  const explosions = [];

  function spawnEnemy() {
    const size = 30 + Math.random()*30;
    const x = Math.random()*(W-40) + 20;
    const y = -size - 10;
    const speed = 1.5 + Math.random()*2.5 + state.speedMultiplier*0.35;
    enemies.push({x,y,w:size,h:size,speed});
  }

  function spawnCoin() {
    const size = 15;
    const x = Math.random()*(W-40) + 20;
    const y = -size - 10;
    const speed = 1 + Math.random()*2 + state.speedMultiplier*0.2;
    coinsArr.push({x,y,w:size,h:size,speed});
  }

  function resetGame() {
    state.running = false;
    state.paused = false;
    state.gameover = false;
    state.win = false;
    state.score = 0;
    state.coins = 0;
    state.spawnTimer = 0;
    state.bulletTimer = 0;
    state.spawnInterval = 1400;
    state.speedMultiplier = 1;
    enemies.length = 0;
    coinsArr.length = 0;
    bullets.length = 0;
    explosions.length = 0;
    player.x = W/2;
    player.y = H-80;
    scoreEl.textContent = state.score;
    coinsEl.textContent = state.coins;
    startBtn.textContent = 'Start';
    render();
  }

  function startGame() {
    if (state.running && !state.gameover && !state.win) return;
    state.running = true;
    state.paused = false;
    state.gameover = false;
    state.win = false;
    state.lastTime = performance.now();
    startBtn.textContent = 'Running...';
    requestAnimationFrame(loop);
  }

  function togglePause() {
    if (!state.running) return;
    state.paused = !state.paused;
    pauseBtn.textContent = state.paused ? 'Resume' : 'Pause';
    if (!state.paused) {
      state.lastTime = performance.now();
      requestAnimationFrame(loop);
    }
  }

  startBtn.addEventListener('click', startGame);
  pauseBtn.addEventListener('click', togglePause);
  resetBtn.addEventListener('click', resetGame);

  function rectsOverlap(a,b){
    return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
  }

  const gameOverSound = new Audio("https://www.soundjay.com/button/beep-07.wav");

  function update(dt) {
    if (!state.running || state.paused || state.gameover || state.win) return;

    player.vx = 0; player.vy=0;
    if (keys['arrowleft'] || keys['a']) player.vx = -player.speed;
    if (keys['arrowright'] || keys['d']) player.vx = player.speed;
    if (keys['arrowup'] || keys['w']) player.vy = -player.speed;
    if (keys['arrowdown'] || keys['s']) player.vy = player.speed;

    player.x += player.vx;
    player.y += player.vy;
    if (player.x < 10) player.x = 10;
    if (player.x + player.w > W-10) player.x = W-10-player.w;
    if (player.y < 10) player.y = 10;
    if (player.y + player.h > H-10) player.y = H-10-player.h;

    // Spawn enemies and coins
    state.spawnTimer += dt;
    state.spawnInterval = Math.max(400, 1400 - state.score * 8);
    if (state.spawnTimer > state.spawnInterval) {
      spawnEnemy();
      if (Math.random() < 0.5) spawnCoin();
      state.spawnTimer = 0;
    }

    // Fire bullets automatically
    state.bulletTimer += dt;
    if (state.bulletTimer > state.bulletInterval) {
      bullets.push({x:player.x+player.w/2, y:player.y, w:6, h:12, speed:8});
      state.bulletTimer = 0;
    }

    // Update bullets
    for (let i=bullets.length-1; i>=0; i--){
      const b = bullets[i];
      b.y -= b.speed;
      if (b.y + b.h < 0) bullets.splice(i,1);
    }

    // Update enemies
    for (let i = enemies.length-1; i>=0; i--) {
      const e = enemies[i];
      e.y += e.speed + state.score*0.003;
      if (e.y - e.h > H) { enemies.splice(i,1); state.score += 1; scoreEl.textContent = state.score; continue; }

      const pRect = {x:player.x, y:player.y, w:player.w, h:player.h};
      const eRect = {x:e.x - e.w/2, y:e.y - e.h/2, w:e.w, h:e.h};

      if (rectsOverlap(pRect,eRect)) {
        state.gameover = true;
        state.running = false;
        gameOverSound.play();
        if (state.score > state.high) {
          state.high = state.score;
          localStorage.setItem('space_dodger_high', state.high);
          highEl.textContent = state.high;
        }
        startBtn.textContent = 'Start';
      }

      // Check bullet collision
      for (let j=bullets.length-1; j>=0; j--){
        const b = bullets[j];
        const bRect = {x:b.x-b.w/2, y:b.y-b.h/2, w:b.w, h:b.h};
        if (rectsOverlap(bRect,eRect)){
          bullets.splice(j,1);
          enemies.splice(i,1);
          state.score += 3;
          scoreEl.textContent = state.score;
          explosions.push({x:e.x, y:e.y, r:0, max:e.w});
          break;
        }
      }
    }

    // Update coins
    for (let i = coinsArr.length-1; i>=0; i--) {
      const c = coinsArr[i];
      c.y += c.speed;
      if (c.y - c.h > H) { coinsArr.splice(i,1); continue; }
      const pRect = {x:player.x, y:player.y, w:player.w, h:player.h};
      const cRect = {x:c.x - c.w/2, y:c.y - c.h/2, w:c.w, h:c.h};
      if (rectsOverlap(pRect,cRect)) {
        coinsArr.splice(i,1);
        state.coins += 1;
        coinsEl.textContent = state.coins;
      }
    }

    // Update stars
    stars.forEach(s => {
      s.y += s.speed;
      if (s.y > H) s.y = 0;
    });

    // Update explosions
    for (let i=explosions.length-1; i>=0; i--){
      const ex = explosions[i];
      ex.r += 2;
      if (ex.r > ex.max) explosions.splice(i,1);
    }
  }

  function drawFighterJet(x,y,w,h){
    ctx.save();
    ctx.translate(x+w/2,y+h/2);
    ctx.fillStyle = '#7fe3ff';
    ctx.fillRect(-w*0.15, -h*0.5, w*0.3, h*0.9);
    ctx.fillStyle = '#00323b';
    ctx.fillRect(-w*0.1, -h*0.45, w*0.2, h*0.2);
    ctx.fillStyle = '#7fe3ff';
    ctx.beginPath();
    ctx.moveTo(-w*0.5, -h*0.1);
    ctx.lineTo(-w*0.15, 0);
    ctx.lineTo(-w*0.15, h*0.25);
    ctx.lineTo(-w*0.5, h*0.1);
    ctx.closePath();
    ctx.fill();
    ctx.beginPath();
    ctx.moveTo(w*0.5, -h*0.1);
    ctx.lineTo(w*0.15, 0);
    ctx.lineTo(w*0.15, h*0.25);
    ctx.lineTo(w*0.5, h*0.1);
    ctx.closePath();
    ctx.fill();
    ctx.fillRect(-w*0.1, h*0.2, w*0.2, h*0.3);
    ctx.restore();
  }

  function render() {
    ctx.clearRect(0,0,W,H);
    ctx.fillStyle = '#03161b';
    ctx.fillRect(0,0,W,H);

    // Draw stars
    stars.forEach(s => {
      ctx.fillStyle = 'rgba(255,255,255,0.8)';
      ctx.beginPath();
      ctx.arc(s.x,s.y,s.size,0,Math.PI*2);
      ctx.fill();
    });

    // Draw bullets
    bullets.forEach(b => {
      ctx.fillStyle = '#00ffea';
      ctx.fillRect(b.x-b.w/2, b.y-b.h/2, b.w, b.h);
    });

    if (!state.gameover && !state.win) drawFighterJet(player.x, player.y, player.w, player.h);

    // Draw enemies (asteroids)
    enemies.forEach(e => {
      ctx.save();
      ctx.translate(e.x,e.y);
      ctx.fillStyle = '#8b5e3c';
      ctx.beginPath();
      ctx.arc(0,0,e.w/2,0,Math.PI*2);
      ctx.fill();
      ctx.strokeStyle = '#654321';
      ctx.lineWidth = 2;
      ctx.stroke();
      ctx.restore();
    });

    // Draw coins
    coinsArr.forEach(c => {
      ctx.save();
      ctx.translate(c.x,c.y);
      ctx.fillStyle = '#ffd700';
      ctx.beginPath();
      ctx.arc(0,0,c.w/2,0,Math.PI*2);
      ctx.fill();
      ctx.strokeStyle = '#e6c200';
      ctx.lineWidth = 2;
      ctx.stroke();
      ctx.restore();
    });

    // Draw explosions
    explosions.forEach(ex => {
      ctx.save();
      ctx.translate(ex.x,ex.y);
      ctx.strokeStyle = 'orange';
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.arc(0,0,ex.r,0,Math.PI*2);
      ctx.stroke();
      ctx.restore();
    });

    ctx.fillStyle = 'rgba(255,255,255,0.04)';
    ctx.fillRect(12,12,180,50);
    ctx.fillStyle = '#e6f7ff';
    ctx.font = '18px ui-sans-serif, system-ui, -apple-system';
    ctx.fillText('Score: ' + state.score, 20, 30);
    ctx.fillText('Coins: ' + state.coins, 20, 50);

    if (!state.running && !state.gameover && !state.win) {
      ctx.fillStyle = 'rgba(0,0,0,0.44)';
      ctx.fillRect(W/2 - 190, H/2 - 60, 380, 120);
      ctx.fillStyle = '#e6f7ff';
      ctx.font = '20px ui-sans-serif';
      ctx.fillText('Press Start to play', W/2 - 75, H/2 - 10);
    }

    if (state.gameover) {
      ctx.fillStyle = 'rgba(0,0,0,0.65)';
      ctx.fillRect(0,0,W,H);
      ctx.fillStyle = '#ffdede';
      ctx.font = '40px ui-sans-serif';
      ctx.fillText('Game Over', W/2 - 110, H/2 - 10);
      ctx.font = '18px ui-sans-serif';
      ctx.fillStyle = '#e6f7ff';
      ctx.fillText('Score: ' + state.score, W/2 - 48, H/2 + 26);
      ctx.font = '14px ui-sans-serif';
      ctx.fillText('Coins collected: ' + state.coins, W/2 - 65, H/2 + 50);
      ctx.fillText('Press R to restart', W/2 - 60, H/2 + 75);
    }
  }

  function loop(now) {
    const dt = now - state.lastTime;
    state.lastTime = now;
    update(dt);
    render();
    if (!state.gameover && !state.win && state.running && !state.paused) requestAnimationFrame(loop);
  }

  render();
})();
</script>
</body>
</html>
